{% extends "base.html" %}

{% block title %}Activity Log{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-history me-2"></i>
                    Activity Log
                </h2>
                <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>
                    Back to Profile
                </a>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list-alt me-2"></i>
                        Your Activity History
                    </h5>
                </div>
                <div class="card-body">
                    {% if activities.items %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Activity Type</th>
                                    <th>Description</th>
                                    <th>IP Address</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for activity in activities.items %}
                                <tr>
                                    <td>
                                        <small class="text-muted">
                                            {{ format_datetime(activity.timestamp) }}
                                        </small>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if activity.activity_type == 'login' %}bg-success
                                            {% elif activity.activity_type == 'logout' %}bg-secondary
                                            {% elif activity.activity_type == 'failed_login' %}bg-danger
                                            {% elif activity.activity_type == 'password_change' %}bg-warning
                                            {% elif activity.activity_type.startswith('create') %}bg-primary
                                            {% elif activity.activity_type.startswith('delete') %}bg-danger
                                            {% else %}bg-info
                                            {% endif %}">
                                            {{ activity.activity_type.replace('_', ' ').title() }}
                                        </span>
                                    </td>
                                    <td>
                                        {{ activity.description or 'No description' }}
                                    </td>
                                    <td>
                                        <small class="text-muted font-monospace">
                                            {{ activity.ip_address or 'N/A' }}
                                        </small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    {% if activities.has_prev or activities.has_next %}
                    <nav aria-label="Activity pagination" class="mt-4">
                        <ul class="pagination justify-content-center">
                            <li class="page-item {% if not activities.has_prev %}disabled{% endif %}">
                                <a class="page-link" 
                                   href="{{ url_for('auth.profile_activity', page=activities.prev_num) if activities.has_prev else '#' }}">
                                    <i class="fas fa-chevron-left"></i>
                                    Previous
                                </a>
                            </li>
                            
                            {% for page_num in activities.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                                {% if page_num %}
                                    <li class="page-item {% if page_num == activities.page %}active{% endif %}">
                                        <a class="page-link" href="{{ url_for('auth.profile_activity', page=page_num) }}">
                                            {{ page_num }}
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            <li class="page-item {% if not activities.has_next %}disabled{% endif %}">
                                <a class="page-link" 
                                   href="{{ url_for('auth.profile_activity', page=activities.next_num) if activities.has_next else '#' }}">
                                    Next
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    {% endif %}

                    <div class="mt-3 text-center text-muted">
                        <small>
                            Showing {{ activities.items|length }} of {{ activities.total }} activities
                        </small>
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No activity recorded yet.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Activity Stats Summary -->
            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="fas fa-sign-in-alt fa-2x text-success mb-2"></i>
                            <h6>Total Logins</h6>
                            <h4>{{ activities.items|selectattr('activity_type', 'equalto', 'login')|list|length }}</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="fas fa-calendar-plus fa-2x text-primary mb-2"></i>
                            <h6>Sessions Created</h6>
                            <h4>{{ activities.items|selectattr('activity_type', 'equalto', 'create_session')|list|length }}</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="fas fa-check-circle fa-2x text-info mb-2"></i>
                            <h6>Attendance Marked</h6>
                            <h4>{{ activities.items|selectattr('activity_type', 'equalto', 'mark_attendance')|list|length }}</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="fas fa-file-alt fa-2x text-warning mb-2"></i>
                            <h6>Reports Viewed</h6>
                            <h4>{{ activities.items|selectattr('activity_type', 'equalto', 'view_report')|list|length }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.table-hover tbody tr:hover {
    background-color: #f8f9fa;
    cursor: default;
}

.badge {
    font-size: 0.85rem;
    padding: 0.35rem 0.65rem;
}

.font-monospace {
    font-family: 'Courier New', monospace;
}
</style>
{% endblock %}